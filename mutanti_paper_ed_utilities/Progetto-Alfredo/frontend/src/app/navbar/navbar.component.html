<nav data-testid="navbar" id="navbar" class="max-w-[1200px] mx-auto grid grid-cols-[1fr_auto] items-center px-4 sm:px-6 lg:px-8 h-full text-white">
  <div class="flex items-center gap-x-3 sm:gap-x-4">
    <a routerLink="/" class="h-full flex items-center">
      <img src="./logo-white-2.png" alt="MemeMuseum Logo" class="h-16 w-auto object-contain">
    </a>
  </div>

  <div class="flex justify-end items-center">
    <div class="hidden md:flex items-center gap-3 lg:gap-4">
      @if(!this.authService.isAuthenticated()){
        <a data-testid="nav-login" class="no-underline text-[0.9rem] sm:text-[0.95rem] py-1 px-2 transition-opacity duration-200 hover:opacity-80" routerLink="/login">Login</a>
        <a data-testid="nav-signup" class="no-underline text-[0.9rem] sm:text-[0.95rem] py-1 px-2 transition-opacity duration-200 hover:opacity-80" routerLink="/signup">Registrazione</a>
      }
      <a data-testid="nav-meme-of-the-day" class="no-underline text-[0.9rem] sm:text-[0.95rem] py-1 px-2 transition-opacity duration-200 hover:opacity-80" routerLink="/meme-del-giorno">Meme del giorno</a>
      <a data-testid="nav-upload-meme" class="no-underline text-[0.9rem] sm:text-[0.95rem] py-1 px-2 transition-opacity duration-200 hover:opacity-80" routerLink="/carica-meme">Carica meme</a>
      
      @if(this.authService.isAuthenticated()){
        <div class="relative">
          <button (click)="toggleDropdown()" type="button" class="flex items-center gap-x-1 focus:outline-none transition-opacity duration-200 hover:opacity-80 p-1 rounded-md">
            <div class="flex flex-col items-center">
              <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 -960 960 960" width="28px" fill="#FFFFFF"><path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg>
              <span class="text-xs font-medium">&commat;{{this.authService.user()}}</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#FFFFFF" class="transition-transform duration-200 ease-in-out self-center" [class.rotate-180]="isDropdownOpen"><path d="M480-345 240-585l56-56 184 183 184-183 56 56-240 240Z"/></svg>
          </button>
          @if(isDropdownOpen) {
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 text-gray-800">
              <a routerLink="/" (click)="logout()" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Logout</a>
            </div>
          }
        </div>
      }
    </div>

    <div class="md:hidden flex items-center gap-x-2">
      @if(this.authService.isAuthenticated()){
        <div class="relative">
          <button (click)="toggleDropdown(); $event.stopPropagation()" type="button" class="flex items-center gap-x-1 focus:outline-none transition-opacity duration-200 hover:opacity-80 p-1 rounded-md">
            <div class="flex flex-col items-center">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg>
              <span class="text-[10px] font-medium">&commat;{{this.authService.user()}}</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#FFFFFF" class="transition-transform duration-200 ease-in-out self-center" [class.rotate-180]="isDropdownOpen"><path d="M480-345 240-585l56-56 184 183 184-183 56 56-240 240Z"/></svg>
          </button>
          @if(isDropdownOpen) {
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 text-gray-800">
              <a routerLink="/" (click)="logout()" class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Logout</a>
            </div>
          }
        </div>
      }

      <button (click)="toggle()" type="button" class="text-white focus:outline-none p-2">
        @if (!isOpen) {
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        } @else {
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        }
      </button>
    </div>
  </div>
</nav>

@if (isOpen) {
  <div class="md:hidden bg-[#4EA8DE] text-white absolute top-16 left-0 right-0 shadow-lg z-40">
    <div class="flex flex-col px-2 pt-2 pb-3 space-y-1 sm:px-3">
      @if(!this.authService.isAuthenticated()){
        <a (click)="handleNavigationClick()" class="block py-2 px-3 rounded-md no-underline text-base font-medium transition-colors duration-150 hover:bg-sky-600 hover:opacity-90" routerLink="/login">Login</a>
        <a (click)="handleNavigationClick()" class="block py-2 px-3 rounded-md no-underline text-base font-medium transition-colors duration-150 hover:bg-sky-600 hover:opacity-90" routerLink="/signup">Registrazione</a>
      }
      <a (click)="handleNavigationClick()" class="block py-2 px-3 rounded-md no-underline text-base font-medium transition-colors duration-150 hover:bg-sky-600 hover:opacity-90" routerLink="/meme-del-giorno">Meme del giorno</a>
      <a (click)="handleNavigationClick()" class="block py-2 px-3 rounded-md no-underline text-base font-medium transition-colors duration-150 hover:bg-sky-600 hover:opacity-90" routerLink="/carica-meme">Carica meme</a>
    </div>
  </div>
}