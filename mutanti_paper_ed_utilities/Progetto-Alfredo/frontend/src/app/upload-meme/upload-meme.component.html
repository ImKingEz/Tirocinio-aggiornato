<div class="bg-[#eef1f5] flex-grow flex flex-col relative">

  <div class="flex-grow flex flex-col items-center justify-center pt-8 pb-24">

    <h1 data-testid="upload-page-title" id="titolo-carica-meme" class="text-3xl font-bold text-gray-800 mb-8">Carica il tuo meme</h1>

    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()"
      class="w-full max-w-2xl bg-white p-8 rounded-lg shadow-lg border border-gray-200 space-y-8">
      <div>
        <h2 class="text-lg font-semibold text-gray-700 mb-3 block">1. Seleziona l'immagine</h2>
        
        <div class="flex items-center gap-4">
          <label for="meme-upload" class="inline-flex items-center gap-2 cursor-pointer bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor">
              <path d="M480-480ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h320v80H200v560h560v-320h80v320q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Zm440-320v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80Z"/>
            </svg>
            <span>Scegli file</span>
          </label>
          <input data-testid="upload-file-input" id="meme-upload" type="file" (change)="onFileChange($event)" accept="image/png, image/jpeg, image/gif" class="hidden">
          
          <div class="flex-grow text-sm text-gray-600">
            @if (uploadForm.get('memeImage')?.value; as file) {
              <span class="italic">{{ file.name }}</span>
            } @else {
              <span class="italic">Nessun file selezionato.</span>
            }
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-2">
          ðŸ’¡Sono accettati solo file con estensione .png, .jpeg e .gif e con proporzioni 1:1 o 4:5.
        </p>
        @if (uploadForm.get('memeImage')?.hasError('imageRatio')) {
          <div class="mt-2 text-red-600 text-sm">
            <p>Formato dell'immagine inserita non valido, scegli un'altra immagine.</p>
          </div>
        }
        @if (uploadForm.get('memeImage')?.hasError('imageLoad')) {
          <div class="mt-2 text-red-600 text-sm">
            <p>Impossibile leggere il file immagine. Potrebbe essere corrotto.</p>
          </div>
        }
      </div>
      <div>
        <label for="tags" class="text-lg font-semibold text-gray-700 mb-3 block">2. Inserisci i tag</label>
        
        <div class="custom-text-input-grey flex items-center bg-gray-200 py-3 px-4 rounded-md text-base focus-within:border focus-within:border-amber-400 focus-within:shadow-[0_0_0_2px_rgba(217,119,6,0.25)] w-full">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-600 mr-3"><path d="m240-160 40-160H120l20-80h160l40-160H180l20-80h160l40-160h80l-40 160h160l40-160h80l-40 160h160l-20 80H660l-40 160h160l-20 80H600l-40 160h-80l40-160H360l-40 160h-80Zm140-240h160l40-160H420l-40 160Z"/></svg>
            <input data-testid="upload-tags-input" type="text" id="tags" formControlName="tags" placeholder="es. calcio, napoli, divertente"
              class="w-full border-none bg-transparent text-gray-800 placeholder-gray-500 focus:outline-none p-0">
        </div>
        @if (uploadForm.get('tags')?.invalid && (uploadForm.get('tags')?.dirty || uploadForm.get('tags')?.touched)) {
          <div class="mt-2 text-red-600 text-sm">
            @if (uploadForm.get('tags')?.hasError('required') || uploadForm.get('tags')?.hasError('pattern')) {
              <p>Devi inserire almeno un tag valido.</p>
            }
            @if (uploadForm.get('tags')?.hasError('maxTags')) {
              <p>Puoi inserire al massimo 3 tag.</p>
            }
            @if (uploadForm.get('tags')?.hasError('alphanumericTags')) {
              <p>I tag possono contenere solo lettere e numeri.</p>
            }
            @if (uploadForm.get('tags')?.hasError('whitespace')) {
              <p>Non si possono inserire solo spazi vuoti.</p>
            }
          </div>
        } @else {
          <p class="text-xs text-gray-500 mt-2 pl-1">
            ðŸ’¡Inserisci uno o piÃ¹ tag separati da una virgola.
          </p>
        }
      </div>
      
    </form>

   <button data-testid="upload-submit-button" id="carica-meme-button" type="button" (click)="onSubmit()" [disabled]="uploadForm.invalid || isUploading"
            class="mt-8 w-auto text-white bg-[#D97706] hover:bg-[#B45309] focus:outline-none focus:ring-2 focus:ring-[#B45309] focus:ring-offset-2 focus:ring-offset-[#eef1f5] font-semibold rounded-lg text-base py-2 px-8 text-center transition-colors duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
      {{ isUploading ? 'Caricamento...' : 'Carica Meme' }}
    </button>
  </div>

  <div class="absolute bottom-0 left-0 p-4 sm:p-6 md:p-8">
    <button type="button" (click)="navigateToHome()"
            class="bg-[#D97706] hover:bg-[#B45309] text-white font-semibold text-base py-2 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-[#B45309] focus:ring-offset-2 focus:ring-offset-[#eef1f5] transition duration-150 ease-in-out">
      Torna alla Home
    </button>
  </div>

</div>